# ðŸŽ¯ Auto-Generated Referral System

## How It Works

### The Bootstrap
- **Only ONE initial code exists**: `GROW!` (owned by SYSTEM)
- All new players must use `GROW!` to enter initially
- SYSTEM doesn't earn referral rewards (bootstrap code only)

### Auto-Code Generation
- **Every new player automatically gets their own unique 5-character referral code**
- Codes are randomly generated: A-Z, 0-9 (e.g., `X7K2M`, `P9BQ4`)
- System checks for uniqueness before creating
- Codes are permanently assigned to that player

### The Growth Cycle
```
1. Alice uses "GROW!" to sign up
   â†’ Alice gets code "X7K2M" (auto-generated)

2. Alice shares "X7K2M" with Bob
   â†’ Bob uses "X7K2M" to sign up
   â†’ Bob gets code "P9BQ4" (auto-generated)
   â†’ Alice earns 2% of Bob's BUD forever

3. Bob shares "P9BQ4" with Carol
   â†’ Carol uses "P9BQ4" to sign up
   â†’ Carol gets code "J5WN8" (auto-generated)
   â†’ Bob earns 2% of Carol's BUD forever

And so on...
```

## Key Features

âœ… **Self-Sustaining**: After initial `GROW!` code, system perpetuates itself  
âœ… **No Manual Setup**: Codes generated automatically on registration  
âœ… **Unique Codes**: Collision detection ensures uniqueness  
âœ… **Immediate Sharing**: Players get their code instantly  
âœ… **Visible in UI**: Code displayed top-left corner with copy button  
âœ… **Single Level**: You only earn from your direct referrals (not multi-level)  

## For Players

### Getting Started
1. Get the `GROW!` code from the project (or from a friend's code)
2. Sign up with username + wallet
3. Receive your unique referral code instantly
4. Share your code to start earning!

### Your Referral Code
- Displayed in **top-left corner** of game
- Click ðŸ“‹ button to copy to clipboard
- Share with friends to earn 2% of their BUD generation
- Code is permanent and unique to you

### Earnings
- Earn **2% of all BUD** generated by anyone who uses your code
- Passive income that scales with referrals
- Automatic payouts every second
- Track earnings in database

## Technical Implementation

### Code Generation Algorithm
```javascript
// 1. Generate random 5-char code (A-Z, 0-9)
function generateReferralCode() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let code = '';
    for (let i = 0; i < 5; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return code; // e.g., "X7K2M"
}

// 2. Check if code already exists
async isCodeUnique(code) {
    // Query database for existing code
    // Return true if unique, false if collision
}

// 3. Retry up to 10 times if collision
// 4. Fallback to timestamp-based code if all retries fail
```

### Probability of Collision
- Character set: 36 (26 letters + 10 digits)
- Code length: 5
- Total possible codes: 36^5 = **60,466,176**
- Collision probability: Very low until millions of users

### Registration Flow
1. Player enters referral code (e.g., "GROW!" or "X7K2M")
2. Code validated against database
3. Player registers with username + wallet
4. System generates unique code for new player
5. New code inserted into `invite_codes` table
6. Code saved to localStorage for quick access
7. Code displayed in game UI

## Database Structure

### invite_codes Table
```sql
code                      TEXT PRIMARY KEY (e.g., "GROW!", "X7K2M")
owner_username            TEXT NOT NULL (e.g., "alice123")
times_used                INTEGER (how many used this code)
total_referral_earnings   NUMERIC (lifetime earnings)
created_at                TIMESTAMP
```

### Example Data
```
code   | owner_username | times_used | total_referral_earnings
-------|----------------|------------|------------------------
GROW!  | SYSTEM         | 100        | 0
X7K2M  | alice123       | 5          | 12500.50
P9BQ4  | bob_user       | 3          | 7800.25
J5WN8  | carol99        | 0          | 0
```

## UI Display

### Referral Code Widget
- **Location**: Top-left corner (fixed position)
- **Design**: Green border, pixel-art style
- **Content**: 
  - Label: "YOUR CODE:"
  - Code: Large, glowing text
  - Button: ðŸ“‹ copy icon
- **Interaction**: Click to copy, shows âœ“ for 2 seconds
- **Mobile**: Responsive sizing (smaller on phones)

## SQL Queries

### Initial Setup
```sql
-- Create GROW! code (only one needed)
INSERT INTO invite_codes (code, owner_username) VALUES
    ('GROW!', 'SYSTEM');
```

### Check Player's Code
```sql
SELECT code, times_used, total_referral_earnings
FROM invite_codes
WHERE owner_username = 'alice123';
```

### See All Codes
```sql
SELECT 
    code,
    owner_username,
    times_used,
    total_referral_earnings
FROM invite_codes
ORDER BY times_used DESC;
```

### Find Referral Chain
```sql
-- Who did Alice refer?
SELECT id, total_bud 
FROM players 
WHERE referred_by = 'alice123';
```

## Testing

### Test the System
1. **First Player**:
   - Use code `GROW!` to register as `testuser1`
   - Check your auto-generated code (top-left UI)
   - Copy your code (e.g., `ABC12`)

2. **Second Player**:
   - Use code `ABC12` to register as `testuser2`
   - Check your auto-generated code (e.g., `XYZ89`)

3. **Verify**:
   ```sql
   SELECT code, owner_username FROM invite_codes;
   -- Should show: GROW!, ABC12, XYZ89
   
   SELECT id, referred_by FROM players;
   -- testuser1 referred_by: SYSTEM
   -- testuser2 referred_by: testuser1
   ```

## Important Notes

### GROW! Code
- Special bootstrap code
- Owned by SYSTEM (no earnings)
- Can be used unlimited times
- First players will all use this code

### Auto-Generated Codes
- Cannot be customized (random generation)
- Cannot be changed once assigned
- Unique to each player (1:1 relationship)
- Displayed immediately after registration

### Referral Earnings
- Single-level only (no MLM)
- 2% fixed rate
- Real-time payouts
- No cap on referrals or earnings

## Advantages

âœ… **No Manual Admin Work**: Codes created automatically  
âœ… **Scalable**: Works from 10 to 10 million users  
âœ… **Fair**: Everyone gets same opportunity  
âœ… **Simple**: One entry code, everyone gets their own  
âœ… **Viral**: Each player becomes an inviter  

## Future Enhancements

- [ ] Custom code creation for verified players
- [ ] Vanity codes (e.g., "ALICE" instead of random)
- [ ] Code analytics dashboard
- [ ] Share buttons (Twitter, Discord, etc.)
- [ ] QR codes for easy sharing
- [ ] Referral leaderboards
- [ ] Milestones (rewards for X referrals)
